<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Revenue â€¢ {{ date }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
</head>

<body class="bg-sky-50 min-h-screen">

<header class="px-6 py-4 bg-white border-b flex justify-between">
  <h1 class="font-semibold text-lg">ğŸ“… Revenue â€” {{ date }}</h1>
  <a href="{{ url_for('revenue_overview') }}" class="text-blue-600">â¬… Back</a>
</header>

<main class="max-w-4xl mx-auto px-6 py-8 space-y-6">

  <!-- Totals -->
  <div class="grid grid-cols-3 gap-4">
    <div class="p-4 bg-white rounded shadow">
      <p class="text-sm text-slate-500">Manual</p>
      <p class="font-semibold">KSh {{ manual_total }}</p>
    </div>
    <div class="p-4 bg-white rounded shadow">
      <p class="text-sm text-slate-500">MPesa</p>
      <p class="font-semibold">KSh {{ mpesa_total }}</p>
    </div>
    <div class="p-4 bg-white rounded shadow">
      <p class="text-sm text-slate-500">Total</p>
      <p class="font-bold text-lg">KSh {{ grand_total }}</p>
    </div>
  </div>

  <!-- Manual entries -->
  <div class="bg-white rounded shadow p-4">
    <h2 class="font-semibold mb-2">Manual Entries</h2>
    {% for e in manual_entries %}
      <div class="flex justify-between text-sm py-1">
        <span>{{ e.category }}</span>
        <span>KSh {{ e.amount }}</span>
      </div>
    {% else %}
      <p class="text-sm text-slate-400">No manual entries</p>
    {% endfor %}
  </div>

  <!-- MPesa -->
  <div class="bg-white rounded shadow p-4">
    <h2 class="font-semibold mb-2">MPesa Transactions</h2>
    {% for m in mpesa_entries %}
      <div class="flex justify-between text-sm py-1">
        <span>{{ m.sender }}</span>
        <span>KSh {{ m.amount }}</span>
      </div>
    {% else %}
      <p class="text-sm text-slate-400">No MPesa transactions</p>
    {% endfor %}
  </div>

  <div class="bg-white rounded shadow p-4">
  <h2 class="font-semibold mb-2">âš ï¸ Anomalies</h2>

  {% if anomalies %}
    {% for a in anomalies %}
      <div class="text-sm mb-1
        {% if a.severity == 'critical' %}
          text-red-600
        {% else %}
          text-yellow-600
        {% endif %}
      ">
        â€¢ {{ a.message }}
      </div>
    {% endfor %}
  {% else %}
    <p class="text-sm text-slate-400">No anomalies detected</p>
  {% endif %}
</div>

{% if ai_summary %}
<div class="bg-white rounded shadow p-4">
  <h2 class="font-semibold mb-2">ğŸ§  AI Summary</h2>
  <p class="text-sm text-slate-700 whitespace-pre-line">
    {{ ai_summary }}
  </p>
</div>
{% endif %}
</div>

  {% if not is_locked %}
  <form method="POST" action="{{ url_for('lock_revenue_day_route') }}">
    <input type="hidden" name="revenue_date" value="{{ date }}">
    <button class="w-full bg-red-600 text-white py-2 rounded">
      ğŸ”’ Lock This Day
    </button>
  </form>

<form method="POST" action="{{ url_for('generate_ai_summary_for_day', date=date) }}">
  <button class="w-full bg-purple-600 text-white py-2 rounded hover:bg-purple-700">
    ğŸ§  Generate AI Summary
  </button>
</form>
{% else %}
  <div class="space-y-3 text-center">
    <p class="text-green-600 font-semibold">ğŸ”’ Day Locked</p>

    <a
      href="{{ url_for('export_revenue_day_csv', date=date) }}"
      class="inline-block bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
    >
      â¬‡ Export CSV
    </a>

<a
  href="{{ url_for('export_revenue_day_pdf', date=date) }}"
  class="inline-block bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-900"
>
  â¬‡ Export PDF
</a>
  </div>
{% endif %}

</main>
</body>
</html>