<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OptiGain Financial Summary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind (layout only) -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
  <!-- OptiGain theme -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- DataTables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
</head>

<body class="min-h-screen flex bg-sky-50 dark:bg-slate-950 transition-colors">

<!-- MOBILE SIDEBAR OVERLAY -->
<div id="mobileSidebarOverlay"
     class="fixed inset-0 bg-black bg-opacity-40 hidden z-40"></div>

<!-- SIDEBAR -->
<aside id="sidebar"
       class="fixed z-50 inset-y-0 left-0 w-60 shadow-xl transform 
              -translate-x-full md:translate-x-0 transition-all duration-300"
       style="background: var(--og-surface); color: var(--og-text-main);">

    <div class="p-6 flex flex-col items-center">
        <img src="{{ url_for('static', filename='logo.png') }}" class="w-20 mb-2">
        <h2 class="font-bold text-xl" style="color: var(--og-primary);">OptiGain</h2>
    </div>

    <nav class="mt-4 px-4 space-y-2">

        <a href="{{ url_for('dashboard') }}"
           class="block p-3 rounded-md font-semibold transition hover:text-white"
           onmouseover="this.style.background='var(--og-primary)'"
           onmouseout="this.style.background='transparent'">
          
           ğŸ“Š Dashboard
        </a>

        <!-- REVENUE -->
        <div>
            <button type="button"
                onclick="toggleMenu('revenueMenu',this)"
                class="w-full flex justify-between items-center p-3 font-semibold rounded-md
                       transition hover:text-white"
                onmouseover="this.style.background='var(--og-primary)'"
                onmouseout="this.style.background='transparent'">
                <span>ğŸ’° Revenue</span><span>â–¾</span>
            </button>

            <div id="revenueMenu" class="ml-4 mt-1 hidden space-y-1">
                <a href="{{ url_for('dashboard') }}"
                   class="block p-2 text-sm rounded hover:text-white"
                   onmouseover="this.style.background='var(--og-primary)'"
                   onmouseout="this.style.background='transparent'">
                   Overview
              
                            
                <a href="{{ url_for('revenue_entry') }}"
                   class="block p-2 text-sm rounded hover:text-white"
                   onmouseover="this.style.background='var(--og-primary)'"
                   onmouseout="this.style.background='transparent'">
                   Split revenue
               <a href="{{ url_for('inventory_adjust') }}"
                  class="block p-2 text-sm rounded hover:text-white"
                  onmouseover="this.style.background='var(--og-primary)'"
                  onmouseout="this.style.background='transparent'">
                 ğŸ§¾ Inventory Adjustment
               </a>
            </div>
        </div>

        <!-- EXPENSES -->
        <div>
            <button type="button"
                onclick="toggleMenu('expensesMenu', this)"
                class="w-full flex justify-between items-center p-3 font-semibold rounded-md
                       transition hover:text-white"
                onmouseover="this.style.background='var(--og-primary)'"
                onmouseout="this.style.background='transparent'">
                <span>â– Expenses</span><span>â–¾</span>
            </button>

            <div id="expensesMenu" class="ml-4 mt-1 hidden space-y-1">
                <a href="{{ url_for('expense_entry') }}"
                   class="block p-2 text-sm rounded hover:text-white"
                   onmouseover="this.style.background='var(--og-primary)'"
                   onmouseout="this.style.background='transparent'">
                   Add Expense
              </a>
            </div>
        </div>


<!-- INVENTORY -->
<div>
  <a href="{{ url_for('inventory_setup') }}"
     class="block p-3 rounded-md font-semibold transition hover:text-white"
     onmouseover="this.style.background='var(--og-primary)'"
     onmouseout="this.style.background='transparent'">
     ğŸ“¦ Inventory Setup
  </a>
</div>


        <!-- FORECASTING -->
        <div>
            <button type="button"
                onclick="toggleMenu('forecastMenu',this)"
                class="w-full flex justify-between items-center p-3 font-semibold rounded-md
                       transition hover:text-white"
                onmouseover="this.style.background='var(--og-primary)'"
                onmouseout="this.style.background='transparent'">
                <span>ğŸ“ˆ Forecasting</span><span>â–¾</span>
            </button>

            <div id="forecastMenu" class="ml-4 mt-1 hidden space-y-1">
                <a href="{{ url_for('trend_forecaster') }}"
                   class="block p-2 text-sm rounded hover:text-white"
                   onmouseover="this.style.background='var(--og-primary)'"
                   onmouseout="this.style.background='transparent'">
                   Trend Forecaster
                <a href="{{ url_for('profit_calculator') }}"
                   class="block p-2 text-sm rounded hover:text-white"
                   onmouseover="this.style.background='var(--og-primary)'"
                   onmouseout="this.style.background='transparent'">
                   Profit Calculator
              </a>
            </div>
        </div>
      


        <a href="{{ url_for('ask') }}"
   class="block p-3 rounded-md font-semibold transition hover:text-white"
   onmouseover="this.style.background='var(--og-primary)'"
   onmouseout="this.style.background='transparent'">
   ğŸ¤– Business Assistant
</a>

<a href="{{ url_for('profile') }}"
   class="block p-3 rounded-md font-semibold transition hover:text-white"
   onmouseover="this.style.background='var(--og-primary)'"
   onmouseout="this.style.background='transparent'">
   ğŸ‘¤ My Profile
</a>

<a href="{{ url_for('logout') }}"
   class="block p-3 rounded-md font-semibold transition hover:text-white"
   onmouseover="this.style.background='var(--og-primary)'"
   onmouseout="this.style.background='transparent'">
   ğŸšª Logout
</a>

    </nav>
</aside>

<!-- MAIN CONTENT -->
<div class="flex-1 md:ml-60 p-4 md:p-6 transition-all">

  <!-- TOP BAR -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-bold">Financial Summary</h1>
      <p class="text-sm opacity-70">File: <strong>{{ filename }}</strong></p>
    </div>

    <div class="flex items-center gap-2">
      <a href="{{ url_for('dashboard') }}"
         class="px-3 py-2 rounded shadow text-sm"
         style="background: var(--og-surface-elevated);">
         â¬… Back
      </a>

      <button id="darkToggle"
              class="w-10 h-10 rounded-full shadow"
              style="background: var(--og-primary); color: white;">
        ğŸŒ™
      </button>
    </div>
  </div>

  <!-- FLASH -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for _, message in messages %}
      <div class="p-3 mb-4 rounded shadow"
           style="background: var(--og-surface);">
        {{ message }}
      </div>
    {% endfor %}
  {% endwith %}

  <!-- SUMMARY CARD -->
  <div class="rounded-lg shadow mb-6" style="background: var(--og-surface);">
    <div class="p-4 text-white rounded-t-lg"
         style="background: var(--og-primary);">
      <h4 class="font-semibold text-lg">ğŸ“Š Financial Summary</h4>
    </div>

    <div class="p-6">

      <!-- ACTIONS -->
      <div class="relative inline-block mb-6">
        <button id="actionToggle"
                class="px-4 py-2 rounded-lg shadow border"
                style="background: var(--og-surface);">
          âš™ Actions
        </button>

        <div id="actionMenu"
             class="block p-3 rounded-md font-semibold transition hover:text-white"
             onmouseover="this.style.background='var(--og-primary)'"
             onmouseout="this.style.background='transparent'"
             style="background: var(--og-surface);">
          {% for label, endpoint in [
            ('ğŸ‘ View Raw Data','preview_file'),
            ('ğŸ“Š Download Excel','download_excel'),
            ('ğŸ“„ Raw CSV','download_csv'),
            ('ğŸ§¹ Cleaned CSV','download_cleaned'),
            ('ğŸ“• PDF Summary','download_raw_pdf'),
            ('ğŸ§¾ Full Report','download_full_report')
          ] %}
          <a/>
          <a href="{{ url_for(endpoint, filename=filename) }}"
             class="block px-4 py-2 hover:opacity-80">
            {{ label }}
          </a>
          {% endfor %}
        </div>
      </div>

      <!-- KPI CARDS -->
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-center">
        {% for label, value in [
          ('Total Revenue',revenue),
          ('Total Expenses',expenses),
          ('Total Profit',profit),
          ('Profit Margin',margin ~ '%')
        ] %}
        <div class="results-kpi">
          <h6>{{ label }}</h6>
          <h5>{{ value }}</h5>
        </div>
        {% endfor %}
      </div>

    </div>
  </div>

  <!-- GENERIC SECTION MACRO -->
  {% macro block(title) %}
  <div class="rounded-lg shadow p-6 mb-6"
       style="background: var(--og-surface);">
    <h4 class="text-xl font-semibold mb-3">{{ title }}</h4>
    {{ caller() }}
  </div>
  {% endmacro %}

  {% call block("ğŸ“ˆ Summary Statistics") %}
    <ul class="space-y-2">
      <li>Total Revenue: {{ revenue }}</li>
      <li>Total Expenses: {{ expenses }}</li>
      <li>Total Profit: {{ profit }}</li>
      <li>Profit Margin: {{ margin }}%</li>
      <li>Average Revenue: {{ avg_revenue }}</li>
      <li>Average Expenses: {{ avg_expenses }}</li>
    </ul>
    {{ chart_html | safe }}
  {% endcall %}

  {% call block("ğŸ“Š Charts Overview") %}
    {{ bar_chart | safe }}
    {{ pie_chart | safe }}
    {{ category_pie_chart | safe }}
    {{ line_chart | safe }}
  {% endcall %}

  {% call block("ğŸ§  AI Advice & Insights") %}
    <div class="p-4 rounded"
         style="background: var(--og-primary-soft);">
      {{ advice | safe }}
    </div>
  {% endcall %}

  {% call block("ğŸ“„ Raw Data") %}
    {{ table_html | safe }}
  {% endcall %}

  <footer class="text-center py-6 opacity-70">
    Â© {{ current_year }} OptiGain. All rights reserved.
  </footer>

</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script>$(document).ready(()=>{$('table').DataTable();});</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("darkToggle");
  const root = document.documentElement;

  if (localStorage.getItem("theme") === "dark") {
    root.classList.add("dark");
  }

  btn.addEventListener("click", () => {
    const dark = root.classList.toggle("dark");
    localStorage.setItem("theme", dark ? "dark" : "light");
  });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const t = document.getElementById("actionToggle");
  const m = document.getElementById("actionMenu");
  t?.addEventListener("click", e => {
    e.stopPropagation(); m.classList.toggle("hidden");
  });
  document.addEventListener("click", () => m?.classList.add("hidden"));
});
</script>

<script>
function toggleMenu(id,btn) {
  const el = document.getElementById(id);
  if (!el) return;
  
  el.classList.toggle("hidden");
  btn.classList.toggle("active-menu");
}

const sidebar = document.getElementById("sidebar");
const toggle = document.getElementById("sidebarToggle");
const overlay = document.getElementById("mobileSidebarOverlay");

toggle?.addEventListener("click", () => {
  sidebar.classList.toggle("-translate-x-full");
  overlay.classList.toggle("hidden");
});
overlay?.addEventListener("click", () => {
  sidebar.classList.add("-translate-x-full");
  overlay.classList.add("hidden");
});

</script>


</body>
</html>