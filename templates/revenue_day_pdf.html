<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 12px;
    }

    h1 {
      text-align: center;
      margin-bottom: 5px;
    }

    .subtitle {
      text-align: center;
      font-size: 11px;
      margin-bottom: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      table-layout: fixed;
    }

    th, td {
      border: 1px solid #333;
      padding: 6px;
      font-size: 11px;
      word-wrap: break-word;
    }

    th {
      background: #f0f0f0;
    }

    .section {
      margin-top: 20px;
    }

    .right {
      text-align: right;
    }

    .bold {
      font-weight: bold;
    }
  </style>
</head>

<body>

<h1>Revenue Report</h1>
<div class="subtitle">
  Date: {{ date }}
</div>

<div class="section">
  <h3>Financial Summary</h3>
  <table>
    <tr>
      <td>MPesa (Gross)</td>
      <td class="right">KSh {{ "%.2f"|format(mpesa_total) }}</td>
    </tr>
    <tr>
      <td>Cash</td>
      <td class="right">KSh {{ "%.2f"|format(manual_total) }}</td>
    </tr>
    <tr>
      <td>Expenses</td>
      <td class="right">- KSh {{ "%.2f"|format(expense_total) }}</td>
    </tr>
    <tr>
      <td class="bold">Net Revenue</td>
      <td class="right bold">KSh {{ "%.2f"|format(net_total) }}</td>
    </tr>
  </table>
</div>

<div class="section">
  <h3>Cash Breakdown</h3>
  <table>
    <tr>
      <th>Category</th>
      <th class="right">Amount (KSh)</th>
    </tr>
    {% for e in manual_entries %}
      <tr>
        <td>{{ e.category }}</td>
        <td class="right">{{ "%.2f"|format(e.amount) }}</td>
      </tr>
    {% else %}
      <tr>
        <td colspan="2">No manual entries</td>
      </tr>
    {% endfor %}
  </table>
</div>

<div class="section">
  <h3>Expenses</h3>
  <table>
    <tr>
      <th>Category</th>
      <th class="right">Amount (KSh)</th>
    </tr>
    {% for e in expense_entries %}
      <tr>
        <td>{{ e.category }}</td>
        <td class="right">- {{ "%.2f"|format(e.amount) }}</td>
      </tr>
    {% else %}
      <tr>
        <td colspan="2">No expenses recorded</td>
      </tr>
    {% endfor %}
  </table>
</div>

<div class="section">
  <h3>MPesa Transactions (Gross Summary)</h3>
  <table>
    <tr>
      <th class="right">Amount (KSh)</th>
      <th>Time</th>
    </tr>
    {% for m in mpesa_entries %}
      <tr>
        <td class="right">{{ "%.2f"|format(m.amount) }}</td>
        <td>{{ m.created_at }}</td>
      </tr>
    {% else %}
      <tr>
        <td colspan="2">No MPesa transactions</td>
      </tr>
    {% endfor %}
  </table>
</div>

</body>
</html>