<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Revenue Forecast ‚Äì OptiGain</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body class="min-h-screen transition-colors"
      style="background: var(--og-bg); color: var(--og-text-main);">

<!-- HEADER -->
<header class="flex items-center gap-3 px-4 py-4 border-b"
        style="border-color: var(--og-border); background: var(--og-surface);">

  <a href="{{ url_for('dashboard') }}"
     class="text-sm font-medium"
     style="color: var(--og-primary);">
     ‚¨Ö Dashboard
  </a>

  <h1 class="text-lg font-semibold">
    üìà Revenue Forecast (Next 6 Months)
  </h1>
</header>

<!-- CONTENT -->
<main class="p-4">

  <div class="rounded-xl shadow p-4"
       style="background: var(--og-surface);">

{% if not_ready %}
‚ö†Ô∏è Forecast needs at least 7 locked revenue days.
Currently: {{ days }}
{% endif %}

    <p class="text-sm opacity-70 mb-3">
      AI projection with statistical confidence bands.
    </p>

    <!-- CHART -->
    <div id="forecastChart" class="w-full h-[70vh]"></div>

  </div>

</main>

<script>

const dates = {{ dates | tojson | safe }};
const predictions = {{ predictions | tojson | safe }};
const upper = {{ upper | tojson | safe }};
const lower = {{ lower | tojson | safe }};
const actualDates = {{ actual_dates| tojson |safe }};
const actualValues = {{ actual_values| tojson |safe }};

const actualTrace = {
  x: actualDates,
  y: actualValues,
  type: 'scatter',
  mode: 'markers',
  name: 'Actual Revenue',
  marker: {
    size: 7
  }
};

// ‚≠ê Main prediction line
const forecastLine = {
  x: dates,
  y: predictions,
  type: 'scatter',
  mode: 'lines',
  name: 'AI Prediction',
  line: {
    width: 4
  }
};

// ‚≠ê Upper confidence band
const upperBand = {
  x: dates,
  y: upper,
  type: 'scatter',
  mode: 'lines',
  line: { width: 0 },
  showlegend: false,
  hoverinfo: 'skip'
};

// ‚≠ê Lower confidence band (filled)
const lowerBand = {
  x: dates,
  y: lower,
  type: 'scatter',
  mode: 'lines',
  fill: 'tonexty',
  name: 'Confidence Range',
  line: { width: 0 },
  hoverinfo: 'skip'
};

const layout = {

  margin: { t: 30, l: 60, r: 20, b: 50 },

  xaxis: {
    title: "Date"
  },

  yaxis: {
    title: "Revenue (KSh)"
  },

  paper_bgcolor: "transparent",
  plot_bgcolor: "transparent",

  hovermode: "x unified",

  font: { size: 14 }
};

Plotly.newPlot(
  "forecastChart",
  [actualTrace, upperBand, lowerBand, forecastLine],
  layout,
  { responsive: true }
);
</script>

</body>
</html>